<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Honda CR-V Service History</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .vehicle-image {
            width: 100%;
            max-width: 600px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
            background: #f0f0f0;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .charts-section {
            padding: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: 280px; /* Fixed height for chart containers */
            display: flex;
            flex-direction: column;
        }
        
        .chart-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }
        
        #costChart, #cumulativeChart, #distributionChart {
            max-width: 100%;
            flex: 1;
            min-height: 0; /* Important for flex child to shrink */
        }
        
        .table-section {
            padding: 30px;
        }
        
        .service-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        tbody tr {
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
            z-index: 2;
            pointer-events: all;
        }
        
        tbody tr:hover {
            background-color: #f8f9ff !important;
            transform: scale(1.001);
        }
        
        tbody tr:focus {
            outline: 2px solid #667eea;
            outline-offset: -2px;
            background-color: #f0f4ff !important;
        }
        
        .table-container {
            position: relative;
        }
        
        thead {
            background: #667eea;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        thead th {
            position: relative;
            pointer-events: none;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .amount {
            font-weight: bold;
            color: #667eea;
        }
        
        .provider {
            color: #666;
            font-size: 0.9em;
        }
        
        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            max-width: 800px;
            margin: 50px auto;
            border-radius: 15px;
            padding: 30px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .detail-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .items-list {
            margin-top: 20px;
        }
        
        .item-row {
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 10px;
                font-size: 0.9em;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2NjY2NjYyIvPgogIDx0ZXh0IHg9IjQwMCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiPkNhciBQaG90byBQbGFjZWhvbGRlcjwvdGV4dD4KICA8dGV4dCB4PSI0MDAiIHk9IjE4MCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Ib25kYSBDUi1WPC90ZXh0Pgo8L3N2Zz4K" alt="Honda CR-V" class="vehicle-image">
            <h1>Honda CR-V</h1>
            <div class="subtitle">Registration: LTI-509 | Service History Analysis</div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">23</div>
                <div class="stat-label">Total Services</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">€6,897.51</div>
                <div class="stat-label">Total Cost</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">€299.89</div>
                <div class="stat-label">Average Cost</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8 years</div>
                <div class="stat-label">Years Tracked</div>
            </div>
        </div>
        
        <div class="charts-section">
            <div class="chart-container">
                <h2 class="chart-title">Service Costs Over Time</h2>
                <canvas id="costChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Cumulative Spending</h2>
                <canvas id="cumulativeChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Cost Distribution</h2>
                <canvas id="distributionChart"></canvas>
            </div>
        </div>
        
        <div class="table-section">
            <h2 class="chart-title">Service History Details</h2>
            <div class="service-table">
                <table id="serviceTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Provider</th>
                            <th>Odometer</th>
                            <th>Amount</th>
                            <th>Invoice</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="detailModal" class="detail-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Service Details</h2>
            <div id="modalContent">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        // Service data embedded
        const serviceData = {"generated_at": "2025-09-02T15:03:07.082005", "vehicle": {"make": "Honda", "model": "CR-V", "registration": "LTI-509", "image_placeholder": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2NjY2NjYyIvPgogIDx0ZXh0IHg9IjQwMCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiPkNhciBQaG90byBQbGFjZWhvbGRlcjwvdGV4dD4KICA8dGV4dCB4PSI0MDAiIHk9IjE4MCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Ib25kYSBDUi1WPC90ZXh0Pgo8L3N2Zz4K"}, "statistics": {"total_services": 23, "total_cost": 6897.51, "average_cost": 299.89, "date_range": {"start": "2018-05-02", "end": "2025-07-28"}, "monthly_spending": {"2018-05": 337.0, "2019-12": 820.0, "2021-02": 116.0, "2021-04": 242.0, "2021-06": 195.0, "2021-09": 90.0, "2021-10": 44.0, "2021-11": 1463.51, "2022-02": 53.0, "2023-04": 557.0, "2023-05": 1325.0, "2023-11": 256.0, "2024-04": 234.0, "2024-05": 254.0, "2024-11": 338.0, "2025-04": 288.0, "2025-07": 285.0}, "yearly_spending": {"2018": 337.0, "2019": 820.0, "2021": 2150.51, "2022": 53.0, "2023": 2138.0, "2024": 826.0, "2025": 573.0}, "provider_stats": {"Järvenpään Automajor Oy": {"count": 21, "total": 5434.0}, "Unknown": {"count": 2, "total": 1463.51}}, "top_service_items": [{"item": "TYÖVELOITUS 001", "count": 20}, {"item": "PIENTARVIKKEET 100", "count": 19}, {"item": "LASINPESUNESTE 020", "count": 8}, {"item": "Formula Prestige V 5W-30 600601", "count": 5}, {"item": "ÖLJYNSUODATIN HONDA OP575", "count": 3}, {"item": "PAKKASNESTE ZERO 015", "count": 3}, {"item": "RAITISILMASUODATIN K1198-2X", "count": 2}, {"item": "RAITISILMASUODATIN 199", "count": 1}, {"item": "Öljynsuodatin 15-00617", "count": 1}, {"item": "PIENTARVIKKEET 100\"", "count": 1}]}, "charts": {"time_series": [{"date": "2018-05-02", "cost": 337.0, "cumulative": 337.0, "provider": "Järvenpään Automajor Oy", "odometer": 249634}, {"date": "2019-12-05", "cost": 548.0, "cumulative": 885.0, "provider": "Järvenpään Automajor Oy", "odometer": 288733}, {"date": "2019-12-20", "cost": 272.0, "cumulative": 1157.0, "provider": "Järvenpään Automajor Oy", "odometer": 289842}, {"date": "2021-02-05", "cost": 116.0, "cumulative": 1273.0, "provider": "Järvenpään Automajor Oy", "odometer": 314777}, {"date": "2021-04-12", "cost": 242.0, "cumulative": 1515.0, "provider": "Järvenpään Automajor Oy", "odometer": 318530}, {"date": "2021-06-01", "cost": 195.0, "cumulative": 1710.0, "provider": "Järvenpään Automajor Oy", "odometer": 322938}, {"date": "2021-09-10", "cost": 20.0, "cumulative": 1730.0, "provider": "Järvenpään Automajor Oy", "odometer": 0}, {"date": "2021-09-21", "cost": 70.0, "cumulative": 1800.0, "provider": "Järvenpään Automajor Oy", "odometer": 330298}, {"date": "2021-10-12", "cost": 44.0, "cumulative": 1844.0, "provider": "Järvenpään Automajor Oy", "odometer": 0}, {"date": "2021-11-15", "cost": 774.52, "cumulative": 2618.52, "provider": "Unknown", "odometer": null}, {"date": "2021-11-15", "cost": 688.99, "cumulative": 3307.51, "provider": "Unknown", "odometer": null}, {"date": "2022-02-08", "cost": 53.0, "cumulative": 3360.51, "provider": "Järvenpään Automajor Oy", "odometer": 336200}, {"date": "2023-04-05", "cost": 557.0, "cumulative": 3917.51, "provider": "Järvenpään Automajor Oy", "odometer": 352226}, {"date": "2023-05-04", "cost": 850.0, "cumulative": 4767.51, "provider": "Järvenpään Automajor Oy", "odometer": 252832}, {"date": "2023-05-05", "cost": 38.0, "cumulative": 4805.51, "provider": "Järvenpään Automajor Oy", "odometer": 0}, {"date": "2023-05-15", "cost": 437.0, "cumulative": 5242.51, "provider": "Järvenpään Automajor Oy", "odometer": 354441}, {"date": "2023-11-21", "cost": 256.0, "cumulative": 5498.51, "provider": "Järvenpään Automajor Oy", "odometer": 367184}, {"date": "2024-04-16", "cost": 234.0, "cumulative": 5732.51, "provider": "Järvenpään Automajor Oy", "odometer": 375149}, {"date": "2024-05-07", "cost": 254.0, "cumulative": 5986.51, "provider": "Järvenpään Automajor Oy", "odometer": 376874}, {"date": "2024-11-05", "cost": 240.0, "cumulative": 6226.51, "provider": "Järvenpään Automajor Oy", "odometer": 387551}, {"date": "2024-11-05", "cost": 98.0, "cumulative": 6324.51, "provider": "Järvenpään Automajor Oy", "odometer": 387591}, {"date": "2025-04-22", "cost": 288.0, "cumulative": 6612.51, "provider": "Järvenpään Automajor Oy", "odometer": 395657}, {"date": "2025-07-28", "cost": 285.0, "cumulative": 6897.51, "provider": "Järvenpään Automajor Oy", "odometer": 400466}], "cost_distribution": {"0-50€": 3, "51-100€": 3, "101-200€": 2, "201-300€": 8, "301-500€": 2, "500€+": 5}}, "receipts": [{"invoice_number": "15029", "service_date": "2025-07-28", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 400466, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 4.73, "total_price": 4.73, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 227.1, "vat_amount": 57.91, "total_with_vat": 285.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690033.pdf", "source": "simple", "id": "1cbaafb4"}, {"invoice_number": "14542", "service_date": "2025-04-22", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 395657, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 5.43, "total_price": 5.43, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}, {"description": "Formula Prestige V 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.5, "total_price": 11.5, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 1.61, "total_price": 1.61, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 229.47, "vat_amount": 58.51, "total_with_vat": 288.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690034.pdf", "source": "simple", "id": "85c43302"}, {"invoice_number": "13764", "service_date": "2024-11-05", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 387551, "service_items": [{"description": "ÖLJYNSUODATIN HONDA OP575", "code": null, "quantity": 1.0, "unit_price": 9.32, "total_price": 9.32, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 3.39, "total_price": 3.39, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}, {"description": "Formula Prestige V 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.5, "total_price": 11.5, "vat_percent": 24.0}, {"description": "RAITISILMASUODATIN KF-6251", "code": null, "quantity": 1.0, "unit_price": 11.31, "total_price": 11.31, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 1.61, "total_price": 1.61, "vat_percent": 24.0}, {"description": "PAKKASNESTE ZERO 015", "code": null, "quantity": 1.0, "unit_price": 8.87, "total_price": 8.87, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 191.23, "vat_amount": 48.76, "total_with_vat": 240.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690005.pdf", "source": "simple", "id": "ed902fd9"}, {"invoice_number": "13767", "service_date": "2024-11-05", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 387591, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 2.03, "total_price": 2.03, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 19.91, "total_with_vat": 98.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690031.pdf", "source": "simple", "id": "e2dae03e"}, {"invoice_number": "12913", "service_date": "2024-05-07", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 376874, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 4.27, "total_price": 4.27, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 204.82, "vat_amount": 49.16, "total_with_vat": 254.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690007.pdf", "source": "simple", "id": "add8ea33"}, {"invoice_number": "12800", "service_date": "2024-04-16", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 375149, "service_items": [{"description": "ÖLJYNSUODATIN HONDA OP575", "code": null, "quantity": 1.0, "unit_price": 9.32, "total_price": 9.32, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 6.88, "total_price": 6.88, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}, {"description": "Formula Prestige V 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.5, "total_price": 11.5, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 1.61, "total_price": 1.61, "vat_percent": 24.0}, {"description": "PAKKASNESTE ZERO 015", "code": null, "quantity": 1.0, "unit_price": 8.87, "total_price": 8.87, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 45.29, "total_with_vat": 234.0, "next_service_km": 109, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690006.pdf", "source": "simple", "id": "b97e0f07"}, {"invoice_number": "12166", "service_date": "2023-11-21", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 367184, "service_items": [{"description": "ÖLJYNSUODATIN HONDA OP575", "code": null, "quantity": 1.0, "unit_price": 9.32, "total_price": 9.32, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 4.19, "total_price": 4.19, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}, {"description": "Formula Prestige V 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.55, "total_price": 11.55, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 1.61, "total_price": 1.61, "vat_percent": 24.0}, {"description": "PAKKASNESTE ZERO 015", "code": null, "quantity": 1.0, "unit_price": 8.87, "total_price": 8.87, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 49.55, "total_with_vat": 256.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690026.pdf", "source": "simple", "id": "3d5e0630"}, {"invoice_number": "11312", "service_date": "2023-05-15", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 354441, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 3.71, "total_price": 3.71, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 352.42, "vat_amount": 84.58, "total_with_vat": 437.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690008.pdf", "source": "simple", "id": "02864205"}, {"invoice_number": "11251", "service_date": "2023-05-05", "vehicle_reg": "IKB-981", "vehicle_make_model": "", "odometer_km": 0, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 2.9, "total_price": 2.9, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 7.35, "total_with_vat": 38.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690030.pdf", "source": "simple", "id": "ec40a59f"}, {"invoice_number": "11245", "service_date": "2023-05-04", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 252832, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 2.58, "total_price": 2.58, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 164.52, "total_with_vat": 850.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690032.pdf", "source": "simple", "id": "abc7c68e"}, {"invoice_number": "11035", "service_date": "2023-04-05", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 352226, "service_items": [{"description": "ÖLJYNSUODATIN HONDA 0OP575", "code": null, "quantity": 1.0, "unit_price": 9.32, "total_price": 9.32, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 5.16, "total_price": 5.16, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 69.35, "total_price": 69.35, "vat_percent": 24.0}, {"description": "Formula Prestige V 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.5, "total_price": 11.5, "vat_percent": 24.0}, {"description": "RAITISILMASUODATIN WP9206", "code": null, "quantity": 1.0, "unit_price": 16.09, "total_price": 16.09, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 1.61, "total_price": 1.61, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 449.19, "vat_amount": 107.81, "total_with_vat": 557.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690012.pdf", "source": "simple", "id": "e49a950e"}, {"invoice_number": "9096", "service_date": "2022-02-08", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 336200, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 3.43, "total_price": 3.43, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 10.26, "total_with_vat": 53.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690010.pdf", "source": "simple", "id": "3d32a43b"}, {"page_number": 1, "invoice_number": null, "service_date": "2021-11-15", "company": "Unknown", "vehicle_reg": null, "odometer_km": null, "total_amount": 774.52, "vat_amount": null, "items": [], "raw_text": "LänsiAuto\n\nKÄTEISKUITTI Sivu: 1\nAsiakas: 8 MV: Kortti\nLaskun numero: 460047575\nPäivämäärä: 15.11.2021 (1)\nViitteenne: /LTI-509 /KM:333772\nViitteemme: LTI-509\nToimituspäivä: 15.11.2021\nSUOMI Maksuehdot:\nEräpäivä:\nHuomautusaika: 7 pv\nViivästyskorko: 8 %\nTyömääräysnumero: 1665247 Korjauspvm: 8.11.2021\nRekisterino: LTI-S09 Moottorino:\nMerkki ja malli: HONDA CR-V 5D MPV Valmistenumero: SHSRD88604U215513\nAUTOMATIC-RD88-4X4/263\nEnsirek.pym: 29.4.2004 Tehdastyyppi:\nAjokilometrit: 333772\nNimike/Tyéselite/Koodi A-hinta Kpl A-hinta ALV 0% Summa ALV 0% ALV Summa *”)\nNOKKAAKSELIT JA JAKOPÄÄ VAIHTO\nNOKKA-AKSELI PAKO, VAIHTO 327,00 1,00 263,71 263,71 63,29 327,00 1\n1101E6\nKOTELO, JAKOPÄÄN KETJU 207,10 1,00 167,02 167,02 40,08 207,10 1\n1101A3\nCAMSHAFT COMP,EXH 774,52 1,00 624,61 562,15 —- 134,92 697,07 1\n14120PPA010 10,00%\nKETJU ( NOKKA-AKSELI\" 263,83 1,00 212,77 191,49 45,96 237,45 1\n14401PNA004 10,00%\nSÄÄDIN (JAKOKETJU) 160,40 1,00 129,35 116,42 27,94 144,36 1\n14510PNA003 10,00%\nGUIDE COMP.C-CHAI 11", "confidence_score": 0.5, "receipt_type": "unknown", "source_file": "Scan_2025-09-02_12-22-58-147 (5).pdf", "source": "complex", "id": "3c4bc9a8", "total_with_vat": 774.52}, {"page_number": 2, "invoice_number": null, "service_date": "2021-11-15", "company": "Unknown", "vehicle_reg": null, "odometer_km": null, "total_amount": 688.99, "vat_amount": null, "items": [], "raw_text": "LänsiAuto\n\nKÄTEISKUITTI Sivu: 2\nMV: Kortti\nAsiakas: 8 Laskun numero: 460047575\nPäivämäärä: 15.11.2021 (1)\nViitteenne: /LTI-509 /KM:333772\nViitteemme: LTI-509\nToimituspäivä: 15.11.2021\nMaksuehdot:\nSUOMI Eräpäivä:\nHuomautusaika: 7 pv\nViivästyskorko: 8 %\nTyömääräysnumero: 1665247 Korjauspvm: 8.11.2021\nRekisterino: LTI-509 Moottorino:\nMerkki ja malli: HONDA CR-V 5D MPV Valmistenumero: SHSRD88604U215513\nAUTOMATIC-RD88-4X4/263\nEnsirek.pvm: 29.4.2004 Tehdastyyppi:\nAjokilometrit: 333772\nNimike/Työselite/Koodi Kpl A-hinta ALV Summa ALV 0% ALV summa *)\n0%\nTARJOUSÖLJY MOOT.OLJY SW30 A3/B4 LL DEXOS2 HANA 5,85 1,50 4,72 6,37 1,53 7,90 1\nF4200000-1 10,00%\nTyökokonaisuuden välisumma yhteensä 2 168,54 2 688,99\n1 Verollinen 24 % 2 168,54 +ALV 24,00 % 520,45 = 2 688,99\nTeitä palveli: Markku Saari\nYhteensä: 2 688,99 EUR\nHUOLLON AJANVARAUS WWW.LANSIAUTO.FI /HUOLTO\nLänsiAuto Hyvinkää Puhelin 010 525 2375 — Pankkiyhteys IBAN SWIFT\nKotipaikka Helsinki Nordea:158330-11905 FI09 1583 3000 0119 05 NDEAFIHH\nAlv-n", "confidence_score": 0.5, "receipt_type": "unknown", "source_file": "Scan_2025-09-02_12-22-58-147 (5).pdf", "source": "complex", "id": "446d84f5", "total_with_vat": 688.99}, {"invoice_number": "8601", "service_date": "2021-10-12", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 0, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 2.69, "total_price": 2.69, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}, {"description": "FORMULA VX LL DPF 5W-30 600601", "code": null, "quantity": 1.0, "unit_price": 11.5, "total_price": 11.5, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 35.49, "vat_amount": 8.52, "total_with_vat": 44.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690011.pdf", "source": "simple", "id": "76ed6357"}, {"invoice_number": "8514", "service_date": "2021-09-21", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 330298, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 1.9, "total_price": 1.9, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 56.46, "vat_amount": 13.55, "total_with_vat": 70.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690016.pdf", "source": "simple", "id": "b26efe0f"}, {"invoice_number": "8471", "service_date": "2021-09-10", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 0, "service_items": [], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 3.87, "total_with_vat": 20.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690014.pdf", "source": "simple", "id": "ae354805"}, {"invoice_number": "8049", "service_date": "2021-06-01", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 322938, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 3.71, "total_price": 3.71, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 37.74, "total_with_vat": 195.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690015.pdf", "source": "simple", "id": "afbf01cf"}, {"invoice_number": "7799", "service_date": "2021-04-12", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 318530, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 4.4, "total_price": 4.4, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}, {"description": "RAITISILMASUODATIN K1198-2X", "code": null, "quantity": 1.0, "unit_price": 12.26, "total_price": 12.26, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 2.42, "total_price": 2.42, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 46.84, "total_with_vat": 242.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690024.pdf", "source": "simple", "id": "28a5e002"}, {"invoice_number": "7558", "service_date": "2021-02-05", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 314777, "service_items": [{"description": "Öljynsuodatin 15-0C617", "code": null, "quantity": 1.0, "unit_price": 8.03, "total_price": 8.03, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 1.65, "total_price": 1.65, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 93.54, "vat_amount": 22.45, "total_with_vat": 116.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690022.pdf", "source": "simple", "id": "d462fec3"}, {"invoice_number": "5933", "service_date": "2019-12-20", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 289842, "service_items": [{"description": "PIENTARVIKKEET 100\"", "code": null, "quantity": 1.0, "unit_price": 4.64, "total_price": 4.64, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 56.13, "total_price": 56.13, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 0.0, "vat_amount": 52.65, "total_with_vat": 272.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690020.pdf", "source": "simple", "id": "6f51b25b"}, {"invoice_number": "5879", "service_date": "2019-12-05", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 288733, "service_items": [{"description": "Öljynsuodatin 15-00617", "code": null, "quantity": 1.0, "unit_price": 8.23, "total_price": 8.23, "vat_percent": 24.0}, {"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 7.08, "total_price": 7.08, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 66.13, "total_price": 66.13, "vat_percent": 24.0}, {"description": "RAITISILMASUODATIN K1198-2X", "code": null, "quantity": 1.0, "unit_price": 12.27, "total_price": 12.27, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 2.42, "total_price": 2.42, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 441.93, "vat_amount": 106.06, "total_with_vat": 548.0, "next_service_km": 100, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690025.pdf", "source": "simple", "id": "21498268"}, {"invoice_number": "3254", "service_date": "2018-05-02", "vehicle_reg": "LTI-509", "vehicle_make_model": "", "odometer_km": 249634, "service_items": [{"description": "PIENTARVIKKEET 100", "code": null, "quantity": 1.0, "unit_price": 5.47, "total_price": 5.47, "vat_percent": 24.0}, {"description": "TYÖVELOITUS 001", "code": null, "quantity": 1.0, "unit_price": 62.9, "total_price": 62.9, "vat_percent": 24.0}, {"description": "RAITISILMASUODATIN 199", "code": null, "quantity": 1.0, "unit_price": 12.5, "total_price": 12.5, "vat_percent": 24.0}, {"description": "LASINPESUNESTE 020", "code": null, "quantity": 1.0, "unit_price": 2.42, "total_price": 2.42, "vat_percent": 24.0}], "labor_total": 0.0, "parts_total": 0.0, "total_before_vat": 271.77, "vat_amount": 65.22, "total_with_vat": 337.0, "next_service_km": null, "service_provider": "Järvenpään Automajor Oy", "filename": "Scan_2025-09-02_12-31-57-1690023.pdf", "source": "simple", "id": "e0364a27"}, {"page_number": 2, "invoice_number": "695028537", "service_date": "2011-01-13", "company": "Veho Autotalot", "vehicle_reg": "LTI-509", "odometer_km": null, "total_amount": null, "vat_amount": null, "items": [], "raw_text": "NAUTI MATKASTA\nKATEISLASKU Sivu: 2\nAsiakas: 1822750 Laskun numero: 695028537 Kopio: 1\nPäivämäärä: 13.1.2011 (1)\nHEISKANEN LAURI Lisätiedot: 0400887900\nViitteemme: LTI-509\nRAJAMAENTIE 25 Toimituspäivä: 13.1.2011\n04200 KERAVA Maksuehdot:\nSUOMI Eräpäivä:\nHuomautusaika: 7 pv\nViivästyskorko: Korkolain mukaan\nTyömääräysnumero: 425310 Korjauspvm: 13.1.2011\nRekisterino: LTI-509 Moottorino: K20A43015532\nMerkki ja malli: HONDA CR-V 2.01 ES AWD SDA Valmistenumero: SHSRD88604U215513\nEnsirek.pvm: 14.5.2004 Tehdastyyppi: RD8864E26\nMittarilukema: 120621\nNimike/Työselite/Koodi Kpl A-hinta ALV 0% — A-hinta Summa ALV ALV Summa *)\n0%\nSiirretty 689,47\nONG\nRAITISILMASUODATTIMEN VAIHTO AINA, KUN PUHALLUSTEHO ON\nHEIKENTYNYT TAI VÄHINTÄÄN 40 000 KM / 24 KK VÄLEIN -\nPAKETTI: 80292SCA, 55€\nPaketti 80292SCA\nRAITISILMASUODATTIMIEN UUSINTA 1,00 20,63 25,38 20,63 4,75 25,38\n80292SCA\nELEMENT FILTER 2,00 12,91 15,88 25,82 5,94 31,76\n80292SCAE11\nRENKAIDEN KUNTOTARKASTUS ===================\nKULUTUSPINNAT:\nETURENKAAT - ", "confidence_score": 0.8, "receipt_type": "service", "source_file": "Scan_2025-09-02_12-22-58-147 (4).pdf", "source": "complex", "id": "fc8eeb93", "total_with_vat": null}, {"page_number": 3, "invoice_number": "695028537", "service_date": "2011-01-13", "company": "Veho Autotalot", "vehicle_reg": "LTI-509", "odometer_km": null, "total_amount": null, "vat_amount": null, "items": [], "raw_text": "NAUTI MATKASTA\nKATEISLASKU Sivu: 3\nAsiakas: 1822750 Laskun numero: 695028537 Kopio: 1\nPäivämäärä: 13.1.2011 (1)\nHEISKANEN LAURI Lisätiedot: 0400887900\nN Viitteemme: LTI-509\nRAJAMAENTIE 25 Toimituspäivä: 13.1.2011\n04200 KERAVA Maksuehdot:\nSUOMI Eräpäivä:\nHuomautusaika: 7 pv\nViivästyskorko: Korkolain mukaan\nTyömääräysnumero: 425310 Korjauspvm: 13.1.2011\nRekisterino: LTI-509 Moottorino: K20A43015532\nMerkki ja malli: HONDA CR-V 2.01 ES AWD SD A Valmistenumero: SHSRD88604U215513\nEnsirek.pvm: 14.5.2004 Tehdastyyppi: RD8864E26\nMittarilukema: 120621\nNimike/Työselite/Koodi Kpl A-hinta ALV 0% — A-hinta SummaALv ALV Summa *)\n0%\nSiirretty 748,61\nMOOTTORIN VENTTIILIKOPPA HIEMAN VUOTAA MOOTTORI-OLJYA >>>\nSOITETTU JA SOVITTU TIIVISTEEN UUSINTA\nVENTTIILIKOPANTIIVISTE UUSINTA 1,00 33,11 40,72 33,11 7,61 40,72\nHO3\nPKG,HEAD COVER 1,00 17,19 21,14 17,19 3,95 21,14\n12341RTA000\nTyökokonaisuuden välisumma yhteensä 658,92 810,47\nTAKAJARRULEVYT + PALASARJA HUONOSSA KUNNOSSA >>> SOITETTU\nJA SOVITTU UUSINTA\nTAKA", "confidence_score": 0.8, "receipt_type": "service", "source_file": "Scan_2025-09-02_12-22-58-147 (4).pdf", "source": "complex", "id": "8adde54f", "total_with_vat": null}, {"page_number": 4, "invoice_number": "695028537", "service_date": "2011-01-13", "company": "Veho Autotalot", "vehicle_reg": "LTI-509", "odometer_km": null, "total_amount": null, "vat_amount": 23.0, "items": [], "raw_text": "[x\n\nNAUTI MATKASTA\nKÄTEISLASKU Sivu: 4\nAsiakas: 1822750 Laskun numero: 695028537 Kopio: 1\nPäivämäärä: 13.1.2011 (1)\nHEISKANEN LAURI Lisätiedot: 0400887900\nViitteemme: LTI-509\nRAJAMÄENTIE 25 Toimituspäivä: 13.1.2011\n04200 KERAVA Maksuehdot:\nSUOMI Eräpäivä:\nHuomautusaika: 7 pv\nViivästyskorko: Korkolain mukaan\nTyömääräysnumero: 425310 Korjauspvm: 13.1.2011\nRekisterino: LTI-509 Moottorino: K20A43015532\nMerkki ja malli: HONDA CR-V 2.01 ES 4WD 5D A Valmistenumero: SHSRD88604U215513\nEnsirek.pvm: 14.5.2004 Tehdastyyppi: RD8864E26\nMittarilukema: 120621\n\nNimike/Työselite/Koodi Kpl A-hinta ALV 0% — A-hinta Summa ALV ALV Summa *)\n0%\n\n1 Verollinen 23 % Veron peruste: 1 045,50 +ALV 23,00 % 240,46 = 1 285,96\n\nVaraa huolto helposti: www.veho.fi/huolto\n\nTeitä palveli: HEINO JARKKO P. 010 569 3243\n\nYhteensä: 1 285,96 EUR\n\nOsoitetiedot Puh, Fax, Internet Alv-tunniste, Y-tunnus Pankkiyhteys IBAN SWIFT\nVeho Autotalot Oy Pitäjänmäki 010 569 13 F116333854 Nordea 159630-00006157 FI72 1596 3000 0061 57 NDEAFIH", "confidence_score": 0.8, "receipt_type": "service", "source_file": "Scan_2025-09-02_12-22-58-147 (4).pdf", "source": "complex", "id": "ec9476c6", "total_with_vat": null}]};
        
        // Initialize charts
        function initCharts() {
            const chartData = serviceData.charts;
            
            // Cost over time chart
            const costCtx = document.getElementById('costChart').getContext('2d');
            new Chart(costCtx, {
                type: 'line',
                data: {
                    labels: chartData.time_series.map(d => d.date),
                    datasets: [{
                        label: 'Service Cost (€)',
                        data: chartData.time_series.map(d => d.cost),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '€' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Cumulative chart
            const cumCtx = document.getElementById('cumulativeChart').getContext('2d');
            new Chart(cumCtx, {
                type: 'line',
                data: {
                    labels: chartData.time_series.map(d => d.date),
                    datasets: [{
                        label: 'Cumulative Cost (€)',
                        data: chartData.time_series.map(d => d.cumulative),
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '€' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Distribution chart
            const distCtx = document.getElementById('distributionChart').getContext('2d');
            const distData = chartData.cost_distribution;
            new Chart(distCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(distData),
                    datasets: [{
                        label: 'Number of Services',
                        data: Object.values(distData),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(102, 126, 234, 0.6)',
                            'rgba(118, 75, 162, 0.6)',
                            'rgba(102, 126, 234, 0.4)',
                            'rgba(118, 75, 162, 0.4)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Populate service table
        function populateTable() {
            const tbody = document.getElementById('tableBody');
            serviceData.receipts.forEach((receipt, index) => {
                const row = document.createElement('tr');
                row.style.cursor = 'pointer';
                row.setAttribute('data-receipt-index', index);
                row.setAttribute('tabindex', '0');
                
                // Add multiple event handlers for better compatibility
                row.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showDetails(index);
                });
                
                row.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.stopPropagation();
                        showDetails(index);
                    }
                });
                
                row.innerHTML = `
                    <td>${receipt.service_date || 'N/A'}</td>
                    <td class="provider">${receipt.service_provider || receipt.company || 'Unknown'}</td>
                    <td>${receipt.odometer_km ? receipt.odometer_km.toLocaleString() + ' km' : 'N/A'}</td>
                    <td class="amount">€${(receipt.total_with_vat || receipt.total_amount || 0).toFixed(2)}</td>
                    <td>${receipt.invoice_number || 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Show service details modal
        function showDetails(index) {
            const receipt = serviceData.receipts[index];
            const modal = document.getElementById('detailModal');
            const modalContent = document.getElementById('modalContent');
            
            let itemsHtml = '';
            if (receipt.service_items && receipt.service_items.length > 0) {
                itemsHtml = '<h3>Service Items</h3><div class="items-list">';
                receipt.service_items.forEach(item => {
                    itemsHtml += `
                        <div class="item-row">
                            <span>${item.description || 'Service'}</span>
                            <span>€${(item.total_price || item.amount || 0).toFixed(2)}</span>
                        </div>
                    `;
                });
                itemsHtml += '</div>';
            } else if (receipt.items && receipt.items.length > 0) {
                itemsHtml = '<h3>Service Items</h3><div class="items-list">';
                receipt.items.forEach(item => {
                    itemsHtml += `
                        <div class="item-row">
                            <span>${item.description || item.item || 'Service'}</span>
                            <span>€${(item.amount || 0).toFixed(2)}</span>
                        </div>
                    `;
                });
                itemsHtml += '</div>';
            }
            
            modalContent.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">Date</div>
                        <div class="detail-value">${receipt.service_date || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Invoice Number</div>
                        <div class="detail-value">${receipt.invoice_number || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Provider</div>
                        <div class="detail-value">${receipt.service_provider || receipt.company || 'Unknown'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Vehicle</div>
                        <div class="detail-value">${receipt.vehicle_reg || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Odometer</div>
                        <div class="detail-value">${receipt.odometer_km ? receipt.odometer_km.toLocaleString() + ' km' : 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Total Amount</div>
                        <div class="detail-value">€${(receipt.total_with_vat || receipt.total_amount || 0).toFixed(2)}</div>
                    </div>
                    ${receipt.vat_amount ? `
                    <div class="detail-item">
                        <div class="detail-label">VAT Amount</div>
                        <div class="detail-value">€${receipt.vat_amount.toFixed(2)}</div>
                    </div>` : ''}
                    ${receipt.next_service_km ? `
                    <div class="detail-item">
                        <div class="detail-label">Next Service</div>
                        <div class="detail-value">${receipt.next_service_km.toLocaleString()} km</div>
                    </div>` : ''}
                </div>
                ${itemsHtml}
            `;
            
            modal.style.display = 'block';
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            populateTable();
        });
    </script>
</body>
</html>